{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState, useRef } from \"react\";\nexport default function useKrakenPrices(symbols, reconnectDelay = 3000) {\n  _s();\n  const [prices, setPrices] = useState({});\n  const wsRef = useRef(null);\n  const heartbeatRef = useRef(null);\n  const reconnectRef = useRef(null);\n  const connect = () => {\n    if (!symbols.length) return;\n    const ws = new WebSocket(\"wss://ws.kraken.com/v2\");\n    wsRef.current = ws;\n    ws.onopen = () => {\n      console.log(\"Connected\");\n      ws.send(JSON.stringify({\n        method: \"subscribe\",\n        params: {\n          channel: \"ticker\",\n          symbol: symbols\n        }\n      }));\n      startHeartbeat(ws);\n    };\n    ws.onmessage = event => {\n      const data = JSON.parse(event.data);\n      if (data.channel !== \"ticker\") return;\n      const {\n        symbol,\n        last\n      } = data;\n\n      //if (!symbol || !last) return;\n\n      setPrices(prev => ({\n        ...prev,\n        [symbol]: parseFloat(last[0])\n      }));\n    };\n    ws.onerror = err => {\n      console.error(\"WebSocket error:\", err);\n    };\n    ws.onclose = () => {\n      console.warn(\"Disconnected\");\n      stopHeartbeat();\n      scheduleReconnect();\n    };\n  };\n  const startHeartbeat = ws => {\n    stopHeartbeat();\n    heartbeatRef.current = setInterval(() => {\n      if (ws.readyState === WebSocket.OPEN) {\n        ws.send(JSON.stringify({\n          method: \"ping\"\n        }));\n        console.log(\"ping\");\n      }\n    }, 15000);\n  };\n  const stopHeartbeat = () => {\n    if (heartbeatRef.current) {\n      clearInterval(heartbeatRef.current);\n      heartbeatRef.current = null;\n    }\n  };\n  const scheduleReconnect = () => {\n    if (reconnectRef.current) return;\n    reconnectRef.current = setTimeout(() => {\n      reconnectRef.current = null;\n      console.log(\"Reconnecting...\");\n      connect();\n    }, reconnectDelay);\n  };\n  useEffect(() => {\n    connect();\n    return () => {\n      stopHeartbeat();\n      if (wsRef.current) wsRef.current.close();\n      if (reconnectRef.current) clearTimeout(reconnectRef.current);\n    };\n  }, [symbols]);\n  return prices;\n}\n_s(useKrakenPrices, \"EkguMfjC/oo4FLmnq+9uaRZyUpM=\");","map":{"version":3,"names":["useEffect","useState","useRef","useKrakenPrices","symbols","reconnectDelay","_s","prices","setPrices","wsRef","heartbeatRef","reconnectRef","connect","length","ws","WebSocket","current","onopen","console","log","send","JSON","stringify","method","params","channel","symbol","startHeartbeat","onmessage","event","data","parse","last","prev","parseFloat","onerror","err","error","onclose","warn","stopHeartbeat","scheduleReconnect","setInterval","readyState","OPEN","clearInterval","setTimeout","close","clearTimeout"],"sources":["C:/Users/User/Documents/Trading212/TradingSimulation/frontend/src/Cryptos/KrakenApi.js"],"sourcesContent":["import { useEffect, useState, useRef } from \"react\";\r\n\r\nexport default function useKrakenPrices(symbols, reconnectDelay = 3000) {\r\n    const [prices, setPrices] = useState({});\r\n    const wsRef = useRef(null);\r\n    const heartbeatRef = useRef(null);\r\n    const reconnectRef = useRef(null);\r\n\r\n    const connect = () => {\r\n        if (!symbols.length) return;\r\n\r\n        const ws = new WebSocket(\"wss://ws.kraken.com/v2\");\r\n        wsRef.current = ws;\r\n\r\n        ws.onopen = () => {\r\n            console.log(\"Connected\");\r\n\r\n            ws.send(JSON.stringify({\r\n                method: \"subscribe\",\r\n                params: {\r\n                    channel: \"ticker\",\r\n                    symbol: symbols\r\n                }\r\n            }));\r\n\r\n            startHeartbeat(ws);\r\n        };\r\n\r\n        ws.onmessage = (event) => {\r\n            const data = JSON.parse(event.data);\r\n\r\n            if (data.channel !== \"ticker\") return;\r\n\r\n            const { symbol, last } = data;\r\n\r\n            //if (!symbol || !last) return;\r\n\r\n            setPrices(prev => ({\r\n                ...prev,\r\n                [symbol]: parseFloat(last[0])\r\n            }));\r\n        };\r\n\r\n        ws.onerror = (err) => {\r\n            console.error(\"WebSocket error:\", err);\r\n        };\r\n\r\n        ws.onclose = () => {\r\n            console.warn(\"Disconnected\");\r\n            stopHeartbeat();\r\n            scheduleReconnect();\r\n        };\r\n    };\r\n\r\n    const startHeartbeat = (ws) => {\r\n        stopHeartbeat();\r\n        heartbeatRef.current = setInterval(() => {\r\n            if (ws.readyState === WebSocket.OPEN) {\r\n                ws.send(JSON.stringify({ method: \"ping\" }));\r\n                console.log(\"ping\");\r\n            }\r\n        }, 15000);\r\n    };\r\n\r\n    const stopHeartbeat = () => {\r\n        if (heartbeatRef.current) {\r\n            clearInterval(heartbeatRef.current);\r\n            heartbeatRef.current = null;\r\n        }\r\n    };\r\n\r\n    const scheduleReconnect = () => {\r\n        if (reconnectRef.current) return;\r\n        reconnectRef.current = setTimeout(() => {\r\n            reconnectRef.current = null;\r\n            console.log(\"Reconnecting...\");\r\n            connect();\r\n        }, reconnectDelay);\r\n    };\r\n\r\n    useEffect(() => {\r\n        connect();\r\n\r\n        return () => {\r\n            stopHeartbeat();\r\n            if (wsRef.current) wsRef.current.close();\r\n            if (reconnectRef.current) clearTimeout(reconnectRef.current);\r\n        };\r\n    }, [symbols]);\r\n\r\n    return prices;\r\n}\r\n"],"mappings":";AAAA,SAASA,SAAS,EAAEC,QAAQ,EAAEC,MAAM,QAAQ,OAAO;AAEnD,eAAe,SAASC,eAAeA,CAACC,OAAO,EAAEC,cAAc,GAAG,IAAI,EAAE;EAAAC,EAAA;EACpE,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAGP,QAAQ,CAAC,CAAC,CAAC,CAAC;EACxC,MAAMQ,KAAK,GAAGP,MAAM,CAAC,IAAI,CAAC;EAC1B,MAAMQ,YAAY,GAAGR,MAAM,CAAC,IAAI,CAAC;EACjC,MAAMS,YAAY,GAAGT,MAAM,CAAC,IAAI,CAAC;EAEjC,MAAMU,OAAO,GAAGA,CAAA,KAAM;IAClB,IAAI,CAACR,OAAO,CAACS,MAAM,EAAE;IAErB,MAAMC,EAAE,GAAG,IAAIC,SAAS,CAAC,wBAAwB,CAAC;IAClDN,KAAK,CAACO,OAAO,GAAGF,EAAE;IAElBA,EAAE,CAACG,MAAM,GAAG,MAAM;MACdC,OAAO,CAACC,GAAG,CAAC,WAAW,CAAC;MAExBL,EAAE,CAACM,IAAI,CAACC,IAAI,CAACC,SAAS,CAAC;QACnBC,MAAM,EAAE,WAAW;QACnBC,MAAM,EAAE;UACJC,OAAO,EAAE,QAAQ;UACjBC,MAAM,EAAEtB;QACZ;MACJ,CAAC,CAAC,CAAC;MAEHuB,cAAc,CAACb,EAAE,CAAC;IACtB,CAAC;IAEDA,EAAE,CAACc,SAAS,GAAIC,KAAK,IAAK;MACtB,MAAMC,IAAI,GAAGT,IAAI,CAACU,KAAK,CAACF,KAAK,CAACC,IAAI,CAAC;MAEnC,IAAIA,IAAI,CAACL,OAAO,KAAK,QAAQ,EAAE;MAE/B,MAAM;QAAEC,MAAM;QAAEM;MAAK,CAAC,GAAGF,IAAI;;MAE7B;;MAEAtB,SAAS,CAACyB,IAAI,KAAK;QACf,GAAGA,IAAI;QACP,CAACP,MAAM,GAAGQ,UAAU,CAACF,IAAI,CAAC,CAAC,CAAC;MAChC,CAAC,CAAC,CAAC;IACP,CAAC;IAEDlB,EAAE,CAACqB,OAAO,GAAIC,GAAG,IAAK;MAClBlB,OAAO,CAACmB,KAAK,CAAC,kBAAkB,EAAED,GAAG,CAAC;IAC1C,CAAC;IAEDtB,EAAE,CAACwB,OAAO,GAAG,MAAM;MACfpB,OAAO,CAACqB,IAAI,CAAC,cAAc,CAAC;MAC5BC,aAAa,CAAC,CAAC;MACfC,iBAAiB,CAAC,CAAC;IACvB,CAAC;EACL,CAAC;EAED,MAAMd,cAAc,GAAIb,EAAE,IAAK;IAC3B0B,aAAa,CAAC,CAAC;IACf9B,YAAY,CAACM,OAAO,GAAG0B,WAAW,CAAC,MAAM;MACrC,IAAI5B,EAAE,CAAC6B,UAAU,KAAK5B,SAAS,CAAC6B,IAAI,EAAE;QAClC9B,EAAE,CAACM,IAAI,CAACC,IAAI,CAACC,SAAS,CAAC;UAAEC,MAAM,EAAE;QAAO,CAAC,CAAC,CAAC;QAC3CL,OAAO,CAACC,GAAG,CAAC,MAAM,CAAC;MACvB;IACJ,CAAC,EAAE,KAAK,CAAC;EACb,CAAC;EAED,MAAMqB,aAAa,GAAGA,CAAA,KAAM;IACxB,IAAI9B,YAAY,CAACM,OAAO,EAAE;MACtB6B,aAAa,CAACnC,YAAY,CAACM,OAAO,CAAC;MACnCN,YAAY,CAACM,OAAO,GAAG,IAAI;IAC/B;EACJ,CAAC;EAED,MAAMyB,iBAAiB,GAAGA,CAAA,KAAM;IAC5B,IAAI9B,YAAY,CAACK,OAAO,EAAE;IAC1BL,YAAY,CAACK,OAAO,GAAG8B,UAAU,CAAC,MAAM;MACpCnC,YAAY,CAACK,OAAO,GAAG,IAAI;MAC3BE,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC;MAC9BP,OAAO,CAAC,CAAC;IACb,CAAC,EAAEP,cAAc,CAAC;EACtB,CAAC;EAEDL,SAAS,CAAC,MAAM;IACZY,OAAO,CAAC,CAAC;IAET,OAAO,MAAM;MACT4B,aAAa,CAAC,CAAC;MACf,IAAI/B,KAAK,CAACO,OAAO,EAAEP,KAAK,CAACO,OAAO,CAAC+B,KAAK,CAAC,CAAC;MACxC,IAAIpC,YAAY,CAACK,OAAO,EAAEgC,YAAY,CAACrC,YAAY,CAACK,OAAO,CAAC;IAChE,CAAC;EACL,CAAC,EAAE,CAACZ,OAAO,CAAC,CAAC;EAEb,OAAOG,MAAM;AACjB;AAACD,EAAA,CAzFuBH,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}