{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useState } from \"react\";\nexport default function useKrakenPrices(pairs) {\n  _s();\n  const [prices, setPrices] = useState({});\n  const wsRef = useRef(null);\n  const reconnectTimeout = useRef(null);\n  const pingInterval = useRef(null);\n  const connect = () => {\n    const ws = new WebSocket(\"wss://ws.kraken.com/v2\");\n    wsRef.current = ws;\n    ws.onopen = () => {\n      console.log(\"Connected to Kraken WebSocket\");\n      ws.send(JSON.stringify({\n        method: \"subscribe\",\n        params: {\n          channel: \"ticker\",\n          symbol: pairs\n        }\n      }));\n\n      // Пинг на всеки 20 сек, за да държим връзката жива\n      pingInterval.current = setInterval(() => {\n        if (ws.readyState === WebSocket.OPEN) {\n          ws.send(JSON.stringify({\n            method: \"ping\"\n          }));\n        }\n      }, 20000);\n    };\n    ws.onmessage = event => {\n      try {\n        const msg = JSON.parse(event.data);\n        if (msg.channel === \"ticker\" && (msg.type === \"snapshot\" || msg.type === \"update\")) {\n          msg.data.forEach(ticker => {\n            setPrices(prev => ({\n              ...prev,\n              [ticker.symbol]: ticker.last\n            }));\n          });\n        } else if (msg.channel === \"heartbeat\") {\n          console.log(\"Heartbeat received\");\n        }\n      } catch (err) {\n        console.error(\"Error parsing message:\", err);\n      }\n    };\n    ws.onerror = err => {\n      console.error(\"WebSocket error:\", err);\n      ws.close();\n    };\n    ws.onclose = () => {\n      console.warn(\"WebSocket closed, reconnecting in 5s...\");\n      clearInterval(pingInterval.current);\n      reconnectTimeout.current = setTimeout(connect, 5000);\n    };\n  };\n  useEffect(() => {\n    connect();\n    return () => {\n      if (wsRef.current) wsRef.current.close();\n      if (reconnectTimeout.current) clearTimeout(reconnectTimeout.current);\n      if (pingInterval.current) clearInterval(pingInterval.current);\n    };\n  }, [pairs]);\n  return prices;\n}\n_s(useKrakenPrices, \"fLuopXBUNL229zCPA5i7nZKwPHM=\");","map":{"version":3,"names":["useEffect","useRef","useState","useKrakenPrices","pairs","_s","prices","setPrices","wsRef","reconnectTimeout","pingInterval","connect","ws","WebSocket","current","onopen","console","log","send","JSON","stringify","method","params","channel","symbol","setInterval","readyState","OPEN","onmessage","event","msg","parse","data","type","forEach","ticker","prev","last","err","error","onerror","close","onclose","warn","clearInterval","setTimeout","clearTimeout"],"sources":["C:/Users/User/Documents/Trading212/TradingSimulation/frontend/src/Cryptos/KrakenApi.js"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\n\r\nexport default function useKrakenPrices(pairs) {\r\n    const [prices, setPrices] = useState({});\r\n    const wsRef = useRef(null);\r\n    const reconnectTimeout = useRef(null);\r\n    const pingInterval = useRef(null);\r\n\r\n    const connect = () => {\r\n        const ws = new WebSocket(\"wss://ws.kraken.com/v2\");\r\n        wsRef.current = ws;\r\n\r\n        ws.onopen = () => {\r\n            console.log(\"Connected to Kraken WebSocket\");\r\n            ws.send(JSON.stringify({\r\n                method: \"subscribe\",\r\n                params: {\r\n                    channel: \"ticker\",\r\n                    symbol: pairs\r\n                }\r\n            }));\r\n\r\n            // Пинг на всеки 20 сек, за да държим връзката жива\r\n            pingInterval.current = setInterval(() => {\r\n                if (ws.readyState === WebSocket.OPEN) {\r\n                    ws.send(JSON.stringify({ method: \"ping\" }));\r\n                }\r\n            }, 20000);\r\n        };\r\n\r\n        ws.onmessage = (event) => {\r\n            try {\r\n                const msg = JSON.parse(event.data);\r\n\r\n                if (msg.channel === \"ticker\" && (msg.type === \"snapshot\" || msg.type === \"update\")) {\r\n                    msg.data.forEach(ticker => {\r\n                        setPrices(prev => ({\r\n                            ...prev,\r\n                            [ticker.symbol]: ticker.last\r\n                        }));\r\n                    });\r\n                } else if (msg.channel === \"heartbeat\") {\r\n                    console.log(\"Heartbeat received\");\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Error parsing message:\", err);\r\n            }\r\n        };\r\n\r\n        ws.onerror = (err) => {\r\n            console.error(\"WebSocket error:\", err);\r\n            ws.close();\r\n        };\r\n\r\n        ws.onclose = () => {\r\n            console.warn(\"WebSocket closed, reconnecting in 5s...\");\r\n            clearInterval(pingInterval.current);\r\n            reconnectTimeout.current = setTimeout(connect, 5000);\r\n        };\r\n    };\r\n\r\n    useEffect(() => {\r\n        connect();\r\n        return () => {\r\n            if (wsRef.current) wsRef.current.close();\r\n            if (reconnectTimeout.current) clearTimeout(reconnectTimeout.current);\r\n            if (pingInterval.current) clearInterval(pingInterval.current);\r\n        };\r\n    }, [pairs]);\r\n\r\n    return prices;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}