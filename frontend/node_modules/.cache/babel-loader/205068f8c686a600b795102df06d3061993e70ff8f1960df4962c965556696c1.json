{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nexport default function useKrakenPrices2(pairs) {\n  _s();\n  const [prices, setPrices] = useState({});\n  const [heartbeatId, setHeartBeatId] = useState();\n  const startHeartbeat = (ws, intervalMs = 15000) => {\n    return setInterval(() => {\n      if (ws.readyState === WebSocket.OPEN) {\n        ws.send(JSON.stringify({\n          method: \"ping\"\n        }));\n        // console.log(\"📡 Ping sent\");\n      }\n    }, intervalMs);\n  };\n  const stopHeartbeat = intervalId => {\n    clearInterval(intervalId);\n  };\n  const stopConnection = connect(\"wss://ws.kraken.com/v2\", event => {\n    const msg = JSON.parse(event.data);\n    console.log(\"📩\", msg);\n  }, ws => {\n    // subscribe след свързване\n    ws.send(JSON.stringify({\n      method: \"subscribe\",\n      params: {\n        channel: \"ticker\",\n        symbol: [\"BTC/USD\", \"ETH/USD\"]\n      }\n    }));\n  });\n  useEffect(() => {\n    const ws = new WebSocket(\"wss://ws.kraken.com/v2\");\n    ws.onopen = () => {\n      ws.send(JSON.stringify({\n        method: \"subscribe\",\n        params: {\n          channel: \"ticker\",\n          symbol: pairs\n        }\n      }));\n      setHeartBeatId(startHeartbeat(ws, 15000));\n    };\n    ws.onmessage = event => {\n      try {\n        const msg = JSON.parse(event.data);\n        console.log(\"📩\", event.data);\n        if (msg.channel === \"ticker\" && (msg.type === \"snapshot\" || msg.type === \"update\")) {\n          msg.data.forEach(ticker => {\n            setPrices(prev => ({\n              ...prev,\n              [ticker.symbol]: ticker.last\n            }));\n          });\n        }\n      } catch (err) {\n        console.error(\"Error:\", err);\n      }\n    };\n    ws.onclose = () => {\n      stopHeartbeat(heartbeatId);\n    };\n    return () => ws.close();\n  }, [pairs]);\n  return prices;\n}\n_s(useKrakenPrices2, \"llCLYOu3QPXvLejIjTnh16xGhcw=\");","map":{"version":3,"names":["useEffect","useState","useKrakenPrices2","pairs","_s","prices","setPrices","heartbeatId","setHeartBeatId","startHeartbeat","ws","intervalMs","setInterval","readyState","WebSocket","OPEN","send","JSON","stringify","method","stopHeartbeat","intervalId","clearInterval","stopConnection","connect","event","msg","parse","data","console","log","params","channel","symbol","onopen","onmessage","type","forEach","ticker","prev","last","err","error","onclose","close"],"sources":["C:/Users/User/Documents/Trading212/TradingSimulation/frontend/src/Cryptos/KrakenApi.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\n\r\nexport default function useKrakenPrices2(pairs) {\r\n    const [prices, setPrices] = useState({});\r\n    const [heartbeatId, setHeartBeatId] = useState();\r\n\r\n    const startHeartbeat = (ws, intervalMs = 15000) => {\r\n        return setInterval(() => {\r\n            if (ws.readyState === WebSocket.OPEN) {\r\n                ws.send(JSON.stringify({ method: \"ping\" }));\r\n                // console.log(\"📡 Ping sent\");\r\n            }\r\n        }, intervalMs);\r\n    }\r\n    const stopHeartbeat = (intervalId) => {\r\n        clearInterval(intervalId);\r\n    }\r\n    const stopConnection = connect(\r\n        \"wss://ws.kraken.com/v2\",\r\n        (event) => {\r\n            const msg = JSON.parse(event.data);\r\n            console.log(\"📩\", msg);\r\n        },\r\n        (ws) => {\r\n            // subscribe след свързване\r\n            ws.send(JSON.stringify({\r\n                method: \"subscribe\",\r\n                params: {\r\n                    channel: \"ticker\",\r\n                    symbol: [\"BTC/USD\", \"ETH/USD\"]\r\n                }\r\n            }));\r\n        }\r\n    );\r\n\r\n    useEffect(() => {\r\n        const ws = new WebSocket(\"wss://ws.kraken.com/v2\");\r\n\r\n        ws.onopen = () => {\r\n            ws.send(JSON.stringify({\r\n                method: \"subscribe\",\r\n                params: {\r\n                    channel: \"ticker\",\r\n                    symbol: pairs\r\n                }\r\n            }));\r\n            setHeartBeatId(startHeartbeat(ws, 15000));\r\n        };\r\n\r\n        ws.onmessage = (event) => {\r\n\r\n            try {\r\n                const msg = JSON.parse(event.data);\r\n                console.log(\"📩\", event.data);\r\n                if (msg.channel === \"ticker\" && (msg.type === \"snapshot\" || msg.type === \"update\")) {\r\n                    msg.data.forEach(ticker => {\r\n                        setPrices(prev => ({\r\n                            ...prev,\r\n                            [ticker.symbol]: ticker.last\r\n                        }));\r\n                    });\r\n                }\r\n\r\n            } catch (err) {\r\n                console.error(\"Error:\", err);\r\n            }\r\n        };\r\n        ws.onclose = () => {\r\n            stopHeartbeat(heartbeatId);\r\n        }\r\n        return () => ws.close();\r\n    }, [pairs]);\r\n\r\n    return prices;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}