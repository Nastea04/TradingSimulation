{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useState } from \"react\";\nexport default function useKrakenPrices(symbols, reconnectDelay = 3000) {\n  _s();\n  const [prices, setPrices] = useState({});\n  const wsRef = useRef(null);\n  const heartbeatRef = useRef(null);\n  const reconnectRef = useRef(null);\n  const symbolsRef = useRef([]);\n  const hasConnectedRef = useRef(false);\n  const connect = () => {\n    var _symbolsRef$current;\n    if (!((_symbolsRef$current = symbolsRef.current) !== null && _symbolsRef$current !== void 0 && _symbolsRef$current.length)) {\n      console.warn(\"â¸ No symbols to subscribe yet\");\n      return;\n    }\n    console.log(\"ðŸ“¡ Connecting...\");\n    const ws = new WebSocket(\"wss://ws.kraken.com/v2\");\n    wsRef.current = ws;\n    ws.onopen = () => {\n      console.log(\"âœ… Connected\");\n      ws.send(JSON.stringify({\n        method: \"subscribe\",\n        params: {\n          channel: \"ticker\",\n          symbol: symbolsRef.current\n        }\n      }));\n      startHeartbeat(ws);\n    };\n    ws.onmessage = event => {\n      var _msg$data;\n      let msg;\n      try {\n        msg = JSON.parse(event.data);\n      } catch {\n        return;\n      }\n      if (msg.channel === \"ticker\" && (_msg$data = msg.data) !== null && _msg$data !== void 0 && _msg$data.length) {\n        const symbol = msg.data[0].symbol;\n        const last = msg.data[0].last;\n        if (last) {\n          setPrices(prev => ({\n            ...prev,\n            [symbol]: parseFloat(last)\n          }));\n        }\n      }\n    };\n    ws.onerror = err => {\n      console.error(\"âŒ WebSocket error:\", err);\n    };\n    ws.onclose = () => {\n      console.warn(\"âš ï¸ Disconnected\");\n      stopHeartbeat();\n      scheduleReconnect();\n    };\n  };\n  const startHeartbeat = ws => {\n    stopHeartbeat();\n    heartbeatRef.current = setInterval(() => {\n      if (ws.readyState === WebSocket.OPEN) {\n        ws.send(JSON.stringify({\n          method: \"ping\"\n        }));\n      }\n    }, 15000);\n  };\n  const stopHeartbeat = () => {\n    if (heartbeatRef.current) {\n      clearInterval(heartbeatRef.current);\n      heartbeatRef.current = null;\n    }\n  };\n  const scheduleReconnect = () => {\n    if (reconnectRef.current) return;\n    reconnectRef.current = setTimeout(() => {\n      reconnectRef.current = null;\n      connect();\n    }, reconnectDelay);\n  };\n\n  // Ð¡Ð²ÑŠÑ€Ð·Ð²Ð°Ð¼Ðµ ÑÐµ, ÐºÐ¾Ð³Ð°Ñ‚Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¸Ñ‚Ðµ ÑÑ‚Ð°Ð½Ð°Ñ‚ Ð½Ð°Ð»Ð¸Ñ‡Ð½Ð¸ Ð·Ð° Ð¿ÑŠÑ€Ð²Ð¸ Ð¿ÑŠÑ‚\n  useEffect(() => {\n    var _wsRef$current;\n    if (!symbols.length) return;\n    symbolsRef.current = symbols;\n    if (!hasConnectedRef.current) {\n      hasConnectedRef.current = true;\n      connect();\n    } else if (((_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.readyState) === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify({\n        method: \"subscribe\",\n        params: {\n          channel: \"ticker\",\n          symbol: symbols\n        }\n      }));\n    }\n  }, [symbols]);\n\n  // Ð§Ð¸ÑÑ‚ÐµÐ½Ðµ ÑÐ°Ð¼Ð¾ Ð¿Ñ€Ð¸ unmount\n  useEffect(() => {\n    return () => {\n      stopHeartbeat();\n      if (wsRef.current) wsRef.current.close();\n      if (reconnectRef.current) clearTimeout(reconnectRef.current);\n    };\n  }, []);\n  return prices;\n}\n_s(useKrakenPrices, \"+tkWbJYJM7+TZeqNMHD7n8OVRBc=\");","map":{"version":3,"names":["useEffect","useRef","useState","useKrakenPrices","symbols","reconnectDelay","_s","prices","setPrices","wsRef","heartbeatRef","reconnectRef","symbolsRef","hasConnectedRef","connect","_symbolsRef$current","current","length","console","warn","log","ws","WebSocket","onopen","send","JSON","stringify","method","params","channel","symbol","startHeartbeat","onmessage","event","_msg$data","msg","parse","data","last","prev","parseFloat","onerror","err","error","onclose","stopHeartbeat","scheduleReconnect","setInterval","readyState","OPEN","clearInterval","setTimeout","_wsRef$current","close","clearTimeout"],"sources":["C:/Users/User/Documents/Trading212/TradingSimulation/frontend/src/Cryptos/KrakenApi.js"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\n\r\nexport default function useKrakenPrices(symbols, reconnectDelay = 3000) {\r\n    const [prices, setPrices] = useState({});\r\n    const wsRef = useRef(null);\r\n    const heartbeatRef = useRef(null);\r\n    const reconnectRef = useRef(null);\r\n    const symbolsRef = useRef([]);\r\n    const hasConnectedRef = useRef(false);\r\n\r\n    const connect = () => {\r\n        if (!symbolsRef.current?.length) {\r\n            console.warn(\"â¸ No symbols to subscribe yet\");\r\n            return;\r\n        }\r\n\r\n        console.log(\"ðŸ“¡ Connecting...\");\r\n        const ws = new WebSocket(\"wss://ws.kraken.com/v2\");\r\n        wsRef.current = ws;\r\n\r\n        ws.onopen = () => {\r\n            console.log(\"âœ… Connected\");\r\n\r\n            ws.send(JSON.stringify({\r\n                method: \"subscribe\",\r\n                params: {\r\n                    channel: \"ticker\",\r\n                    symbol: symbolsRef.current\r\n                }\r\n            }));\r\n\r\n            startHeartbeat(ws);\r\n        };\r\n\r\n        ws.onmessage = (event) => {\r\n            let msg;\r\n            try {\r\n                msg = JSON.parse(event.data);\r\n            } catch {\r\n                return;\r\n            }\r\n\r\n            if (msg.channel === \"ticker\" && msg.data?.length) {\r\n                const symbol = msg.data[0].symbol;\r\n                const last = msg.data[0].last;\r\n                if (last) {\r\n                    setPrices(prev => ({\r\n                        ...prev,\r\n                        [symbol]: parseFloat(last)\r\n                    }));\r\n                }\r\n            }\r\n        };\r\n\r\n        ws.onerror = (err) => {\r\n            console.error(\"âŒ WebSocket error:\", err);\r\n        };\r\n\r\n        ws.onclose = () => {\r\n            console.warn(\"âš ï¸ Disconnected\");\r\n            stopHeartbeat();\r\n            scheduleReconnect();\r\n        };\r\n    };\r\n\r\n    const startHeartbeat = (ws) => {\r\n        stopHeartbeat();\r\n        heartbeatRef.current = setInterval(() => {\r\n            if (ws.readyState === WebSocket.OPEN) {\r\n                ws.send(JSON.stringify({ method: \"ping\" }));\r\n            }\r\n        }, 15000);\r\n    };\r\n\r\n    const stopHeartbeat = () => {\r\n        if (heartbeatRef.current) {\r\n            clearInterval(heartbeatRef.current);\r\n            heartbeatRef.current = null;\r\n        }\r\n    };\r\n\r\n    const scheduleReconnect = () => {\r\n        if (reconnectRef.current) return;\r\n        reconnectRef.current = setTimeout(() => {\r\n            reconnectRef.current = null;\r\n            connect();\r\n        }, reconnectDelay);\r\n    };\r\n\r\n    // Ð¡Ð²ÑŠÑ€Ð·Ð²Ð°Ð¼Ðµ ÑÐµ, ÐºÐ¾Ð³Ð°Ñ‚Ð¾ ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¸Ñ‚Ðµ ÑÑ‚Ð°Ð½Ð°Ñ‚ Ð½Ð°Ð»Ð¸Ñ‡Ð½Ð¸ Ð·Ð° Ð¿ÑŠÑ€Ð²Ð¸ Ð¿ÑŠÑ‚\r\n    useEffect(() => {\r\n        if (!symbols.length) return;\r\n        symbolsRef.current = symbols;\r\n\r\n        if (!hasConnectedRef.current) {\r\n            hasConnectedRef.current = true;\r\n            connect();\r\n        } else if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n            wsRef.current.send(JSON.stringify({\r\n                method: \"subscribe\",\r\n                params: {\r\n                    channel: \"ticker\",\r\n                    symbol: symbols\r\n                }\r\n            }));\r\n        }\r\n    }, [symbols]);\r\n\r\n    // Ð§Ð¸ÑÑ‚ÐµÐ½Ðµ ÑÐ°Ð¼Ð¾ Ð¿Ñ€Ð¸ unmount\r\n    useEffect(() => {\r\n        return () => {\r\n            stopHeartbeat();\r\n            if (wsRef.current) wsRef.current.close();\r\n            if (reconnectRef.current) clearTimeout(reconnectRef.current);\r\n        };\r\n    }, []);\r\n\r\n    return prices;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}